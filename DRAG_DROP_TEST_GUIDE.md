# 拖拽功能测试指南

## 测试内容概述
这份指南将帮助你测试刚刚修复的拖拽功能，特别是解决"不允许"光标图标的问题。

## 🎯 修复内容总结
1. **域名标签页拖拽重排** - 域名导航栏中的标签页可以拖拽改变顺序
2. **WebView标签页拖拽重排** - 浏览器页面中的WebView标签页可以拖拽改变顺序
3. **标签页分离到新窗口** - 将标签页拖拽到应用外部可创建独立窗口
4. **智能合并回主窗口** - 拖拽分离的窗口接触主窗口标签栏时自动合并
5. **修复拖拽光标显示** - 解决拖拽时显示"不允许"图标的问题

## 🔧 具体修复点
### 代码修复
- **设置拖拽属性**: `dataTransfer.effectAllowed = 'all'`
- **动态光标反馈**: 根据拖拽位置显示不同光标（move/copy）
- **全局事件处理**: 添加全局 dragover/drop 事件监听器
- **防止默认行为**: 阻止浏览器默认拖拽行为导致的"不允许"光标

## 📋 测试步骤

### 1. 域名标签页拖拽测试
**目标**: 测试域名导航栏标签页重排功能

1. **准备环境**:
   - 确保应用已启动
   - 在域名管理中添加多个域名（如果没有的话）
   - 打开多个域名标签页

2. **测试拖拽重排**:
   ```
   ✅ 鼠标按住域名标签页
   ✅ 拖拽到其他域名标签页之间
   ✅ 观察是否显示插入指示器
   ✅ 释放鼠标，检查域名顺序是否改变
   ✅ 拖拽过程中光标应显示为"移动"图标，不是"不允许"
   ```

3. **测试分离到新窗口**:
   ```
   ✅ 鼠标按住域名标签页
   ✅ 拖拽到应用窗口外部区域
   ✅ 观察光标是否变为"复制"图标（表示分离）
   ✅ 释放鼠标，检查是否创建新的独立窗口
   ✅ 新窗口应该显示该域名的内容
   ```

### 2. WebView标签页拖拽测试
**目标**: 测试浏览器页面中WebView标签页功能

1. **准备环境**:
   - 选择一个域名进入浏览器页面
   - 打开多个WebView标签页（可以通过链接或手动添加）

2. **测试标签页重排**:
   ```
   ✅ 鼠标按住WebView标签页
   ✅ 拖拽到其他标签页之间
   ✅ 观察插入位置的视觉指示
   ✅ 释放鼠标，检查标签页顺序
   ✅ 拖拽过程中光标应显示为"移动"图标
   ```

3. **测试分离到新窗口**:
   ```
   ✅ 鼠标按住WebView标签页
   ✅ 拖拽到应用窗口边界外
   ✅ 观察光标变化（移动→复制）
   ✅ 释放鼠标创建独立浏览器窗口
   ✅ 新窗口应该加载该标签页的内容
   ```

### 3. 智能合并测试
**目标**: 测试分离窗口的智能合并功能

1. **测试WebView窗口合并**:
   ```
   ✅ 首先分离一个WebView标签页到独立窗口
   ✅ 拖拽独立窗口接近主窗口的WebView标签栏
   ✅ 观察是否触发合并逻辑
   ✅ 检查标签页是否正确合并回主窗口
   ✅ 独立窗口应该自动关闭
   ```

### 4. 光标显示修复验证
**目标**: 确认不再显示"不允许"图标

1. **关键测试点**:
   ```
   ✅ 在应用内拖拽 - 应显示"移动"光标 (↕️)
   ✅ 拖拽到应用外 - 应显示"复制"光标 (📋)
   ✅ 不应该出现"🚫"(不允许)光标
   ✅ 拖拽过程流畅，没有闪烁
   ```

## 🐛 问题排查

### 如果仍然出现"不允许"光标：
1. **检查控制台输出**:
   - 打开开发者工具 (F12)
   - 查看是否有拖拽相关的错误信息
   - 注意拖拽状态的日志输出

2. **验证事件处理**:
   ```javascript
   // 在控制台中检查拖拽事件
   console.log('Drag state:', window.dragState);
   ```

3. **重启应用**:
   - 完全关闭应用
   - 重新运行 `npm run dev`

### 如果分离窗口功能异常：
1. **检查Electron进程**:
   - 确认main.ts中的窗口创建逻辑
   - 查看终端输出的Electron日志

2. **验证IPC通信**:
   - 检查preload.ts是否正确暴露API
   - 确认渲染进程能访问window.electronAPI

## 📊 测试完成检查清单

### 基础功能 ✅
- [ ] 域名标签页可以拖拽重排
- [ ] WebView标签页可以拖拽重排
- [ ] 拖拽过程中有正确的视觉反馈
- [ ] 拖拽释放后标签页顺序正确更新

### 分离功能 ✅
- [ ] 域名标签页可以分离到新窗口
- [ ] WebView标签页可以分离到新窗口
- [ ] 分离的窗口正确显示内容
- [ ] 分离窗口可以独立操作

### 合并功能 ✅
- [ ] 分离的WebView窗口可以合并回主窗口
- [ ] 合并时标签页插入到正确位置
- [ ] 合并后独立窗口自动关闭

### 光标修复 ✅
- [ ] 应用内拖拽显示"移动"光标
- [ ] 应用外拖拽显示"复制"光标
- [ ] 不再出现"不允许"光标
- [ ] 光标切换流畅自然

## 🎉 成功标准
当所有测试项目都通过时，说明拖拽功能已经完全修复并正常工作。用户现在可以：
1. 自由重排标签页顺序
2. 将标签页分离到独立窗口
3. 将分离的窗口合并回主应用
4. 享受流畅的拖拽体验，没有误导性的光标图标

## 🔗 相关文件
- `src/components/domain-nav/index.vue` - 域名导航拖拽
- `src/components/browser-page/index.vue` - WebView标签拖拽
- `electron/main.ts` - 窗口管理和IPC处理
- `electron/preload.ts` - API桥接
- `src/assets/styles/drag-drop.css` - 拖拽样式

---
*测试完成后，你就可以享受完整的多标签页拖拽功能了！* 🎊
