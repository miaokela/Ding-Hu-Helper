<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åè®®æ‹¦æˆªæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-link {
            display: inline-block;
            margin: 10px;
            padding: 10px 15px;
            background: #007AFF;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.2s;
        }
        .test-link:hover {
            background: #0056CC;
        }
        .dangerous {
            background: #FF3B30;
        }
        .dangerous:hover {
            background: #D70015;
        }
        .safe {
            background: #34C759;
        }
        .safe:hover {
            background: #248A3D;
        }
        .test-button {
            display: inline-block;
            margin: 10px;
            padding: 10px 15px;
            background: #FF9500;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .test-button:hover {
            background: #CC7700;
        }
        .log {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: Monaco, Consolas, monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª åè®®æ‹¦æˆªæµ‹è¯•é¡µé¢</h1>
    <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•åº”ç”¨çš„åè®®æ‹¦æˆªåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚ç‚¹å‡»ä¸‹æ–¹é“¾æ¥å’ŒæŒ‰é’®ï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºã€‚</p>

    <div class="test-section">
        <h2>ğŸš¨ å±é™©åè®®é“¾æ¥æµ‹è¯•ï¼ˆåº”è¯¥è¢«æ‹¦æˆªï¼‰</h2>
        <p>ä»¥ä¸‹é“¾æ¥åº”è¯¥è¢«æ‹¦æˆªï¼Œä¸ä¼šè§¦å‘ç³»ç»Ÿå¼¹çª—æˆ–æ‰“å¼€å¤–éƒ¨åº”ç”¨ï¼š</p>
        
        <a href="bytedance://dispatch_message/" class="test-link dangerous">å­—èŠ‚è·³åŠ¨åè®®</a>
        <a href="douyin://profile/user/" class="test-link dangerous">æŠ–éŸ³åè®®</a>
        <a href="toutiao://article/123456/" class="test-link dangerous">å¤´æ¡åè®®</a>
        <a href="xigua://video/789" class="test-link dangerous">è¥¿ç“œè§†é¢‘åè®®</a>
        <a href="aweme://user/123" class="test-link dangerous">awemeåè®®</a>
        <a href="snssdk://main" class="test-link dangerous">snssdkåè®®</a>
        <a href="intent://main" class="test-link dangerous">Intentåè®®</a>
        <a href="market://details?id=com.example" class="test-link dangerous">Marketåè®®</a>
    </div>

    <div class="test-section">
        <h2>ğŸ”— å±é™©URLæ¨¡å¼æµ‹è¯•ï¼ˆåº”è¯¥è¢«æ‹¦æˆªï¼‰</h2>
        <p>ä»¥ä¸‹URLåŒ…å«å±é™©æ¨¡å¼ï¼Œåº”è¯¥è¢«æ‹¦æˆªï¼š</p>
        
        <a href="https://security.zijieapi.com/api/link?url=bytedance://test" class="test-link dangerous">å­—èŠ‚APIé“¾æ¥</a>
        <a href="https://example.com/openapp.do?scheme=douyin" class="test-link dangerous">openappé“¾æ¥</a>
        <a href="https://example.com/deeplink?target=bytedance://main" class="test-link dangerous">deeplinké“¾æ¥</a>
        <a href="https://example.com/dispatch_message?data=test" class="test-link dangerous">dispatch_messageé“¾æ¥</a>
    </div>

    <div class="test-section">
        <h2>âœ… å®‰å…¨é“¾æ¥æµ‹è¯•ï¼ˆåº”è¯¥æ­£å¸¸å·¥ä½œï¼‰</h2>
        <p>ä»¥ä¸‹é“¾æ¥æ˜¯å®‰å…¨çš„ï¼Œåº”è¯¥æ­£å¸¸å·¥ä½œï¼š</p>
        
        <a href="https://www.baidu.com" class="test-link safe">ç™¾åº¦</a>
        <a href="https://www.google.com" class="test-link safe">Google</a>
        <a href="https://github.com" class="test-link safe">GitHub</a>
        <a href="mailto:test@example.com" class="test-link safe">é‚®ä»¶é“¾æ¥</a>
    </div>

    <div class="test-section">
        <h2>âš™ï¸ JavaScriptæµ‹è¯•</h2>
        <p>æµ‹è¯•é€šè¿‡JavaScriptè§¦å‘çš„åè®®è·³è½¬ï¼š</p>
        
        <button class="test-button" onclick="testWindowOpen()">window.openå±é™©åè®®</button>
        <button class="test-button" onclick="testLocationHref()">location.hrefå±é™©åè®®</button>
        <button class="test-button" onclick="testCreateIframe()">iframeå±é™©src</button>
        <button class="test-button" onclick="testSafeLink()">å®‰å…¨é“¾æ¥æµ‹è¯•</button>
        
        <div id="log" class="log">
            <div>ğŸ“ æµ‹è¯•æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
        </div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            logDiv.appendChild(div);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function testWindowOpen() {
            log('ğŸ§ª æµ‹è¯• window.open("bytedance://test")');
            try {
                const result = window.open('bytedance://test', '_blank');
                if (result === null) {
                    log('âœ… window.open è¢«æˆåŠŸæ‹¦æˆªï¼ˆè¿”å›nullï¼‰');
                } else {
                    log('âŒ window.open æœªè¢«æ‹¦æˆª');
                }
            } catch (error) {
                log('âœ… window.open æŠ›å‡ºå¼‚å¸¸è¢«æ‹¦æˆª: ' + error.message);
            }
        }

        function testLocationHref() {
            log('ğŸ§ª æµ‹è¯• location.href = "douyin://profile"');
            try {
                const oldHref = location.href;
                location.href = 'douyin://profile';
                // å¦‚æœURLæ²¡æœ‰æ”¹å˜ï¼Œè¯´æ˜è¢«æ‹¦æˆªäº†
                setTimeout(() => {
                    if (location.href === oldHref) {
                        log('âœ… location.href è¢«æˆåŠŸæ‹¦æˆª');
                    } else {
                        log('âŒ location.href æœªè¢«æ‹¦æˆª');
                    }
                }, 100);
            } catch (error) {
                log('âœ… location.href æŠ›å‡ºå¼‚å¸¸è¢«æ‹¦æˆª: ' + error.message);
            }
        }

        function testCreateIframe() {
            log('ğŸ§ª æµ‹è¯•åˆ›å»ºiframeå¹¶è®¾ç½®å±é™©src');
            try {
                const iframe = document.createElement('iframe');
                iframe.setAttribute('src', 'toutiao://article/123');
                document.body.appendChild(iframe);
                
                setTimeout(() => {
                    if (iframe.src === '' || iframe.src === 'about:blank') {
                        log('âœ… iframe src è¢«æˆåŠŸæ‹¦æˆª');
                    } else {
                        log('âŒ iframe src æœªè¢«æ‹¦æˆª: ' + iframe.src);
                    }
                    document.body.removeChild(iframe);
                }, 100);
            } catch (error) {
                log('âœ… iframe åˆ›å»ºè¢«æ‹¦æˆª: ' + error.message);
            }
        }

        function testSafeLink() {
            log('ğŸ§ª æµ‹è¯•å®‰å…¨é“¾æ¥');
            try {
                const result = window.open('https://www.baidu.com', '_blank');
                if (result) {
                    log('âœ… å®‰å…¨é“¾æ¥æ­£å¸¸å·¥ä½œ');
                    result.close();
                } else {
                    log('âš ï¸ å®‰å…¨é“¾æ¥è¢«é˜»æ­¢ï¼ˆå¯èƒ½æ˜¯å¼¹çª—æ‹¦æˆªå™¨ï¼‰');
                }
            } catch (error) {
                log('âŒ å®‰å…¨é“¾æ¥å‡ºé”™: ' + error.message);
            }
        }

        // ç›‘å¬ç‚¹å‡»äº‹ä»¶
        document.addEventListener('click', function(e) {
            if (e.target.tagName === 'A' && e.target.href) {
                log('ğŸ” ç‚¹å‡»é“¾æ¥: ' + e.target.href);
            }
        });

        log('ğŸ“± é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•');
    </script>
</body>
</html>
